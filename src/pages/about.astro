---
import AboutLayout from "../layouts/AboutLayout.astro";

// Fetch GitHub stats
const username = "gogoro";
let githubStats = null;
let yearlyContributions = null;

try {
  const response = await fetch(`https://api.github.com/users/${username}`);
  if (response.ok) {
    githubStats = await response.json();
  }
} catch (error) {
  console.error("Failed to fetch GitHub stats:", error);
}

// Fetch yearly contributions using GitHub GraphQL API
const githubToken = import.meta.env.GITHUB_TOKEN;

if (githubToken) {
  try {
    const query = `
      query($userName:String!) {
        user(login: $userName){
          contributionsCollection {
            contributionCalendar {
              totalContributions
            }
          }
        }
      }
    `;

    const graphqlResponse = await fetch('https://api.github.com/graphql', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${githubToken}`
      },
      body: JSON.stringify({
        query,
        variables: { userName: username }
      })
    });

    if (graphqlResponse.ok) {
      const data = await graphqlResponse.json();
      if (data.data?.user?.contributionsCollection?.contributionCalendar?.totalContributions) {
        const total = data.data.user.contributionsCollection.contributionCalendar.totalContributions;
        yearlyContributions = total.toLocaleString();
      }
    }
  } catch (error) {
    console.error("Failed to fetch GitHub contributions:", error);
  }
}
---

<AboutLayout
  title="About Ole Herland"
  description="Builder and technology enthusiast with an entrepreneurial background"
  longDescription="Learn about Ole Herland's passion for technology, entrepreneurial journey, and the brands he's worked with over the years"
>
  <p>
    I'm a builder and L.O.V.E technology.
  </p>

  <p>I love to build, tinker, explore and try out new things. From starting and selling
  businesses, quitting everything to become a full-time investor, then dropping that to
  become a full-time twitch/youtube gamer, to getting back to my roots as a programmer.</p>

  <p>Now I enjoy being a dad to two fantastic girls, spending time with my girlfriend, 
  and building products for myself and clients. </p>

  <p>I'm just very stoked on life and enjoy the process.</p>

  <p>Now I work hard on my products, do consulting, and write about my journey.</p>

  <h2>Contact</h2>
  <p>
    You can DM me on <a href="https://x.com/oleherland" target="_blank" rel="noopener noreferrer">x.com/@oleherland</a>,
    check out my profile on <a href="https://github.com/gogoro" target="_blank" rel="noopener noreferrer">github.com/gogoro</a>,
    or connect with me on <a href="https://www.linkedin.com/in/oleherland/" target="_blank" rel="noopener noreferrer">LinkedIn</a>.
  </p>

  <h2>GitHub Activity</h2>
  {(githubStats || yearlyContributions) && (
    <p>
      {yearlyContributions && (
        <>
          <strong>{yearlyContributions}</strong> contributions in the last year
          {githubStats && " • "}
        </>
      )}
      {githubStats && (
        <>
          <strong>{githubStats.public_repos}</strong> public repositories •
          <strong>{githubStats.followers}</strong> followers •
          <strong>{githubStats.following}</strong> following
        </>
      )}
    </p>
  )}
  <img src="https://ghchart.rshah.org/gogoro" alt="Ole Herland's GitHub Contributions" />
</AboutLayout>
